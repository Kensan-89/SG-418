<context>
  <story>
    **Story 2.4: Unified Agenda View**

    As a logged-in user,
    I want to see my Canvas assignments, personal tasks, and Google Calendar events in a single, unified agenda,
    So that I have a complete and holistic overview of all my commitments.

    **Acceptance Criteria:**
    1. The "Agenda" view now includes events from the user's selected Google Calendars.
    2. All items (tasks, assignments, events) are sorted chronologically.
    3. Each item type is visually distinct.
    4. The view is performant and easy to read, even with many items.
  </story>

  <tech-spec>
    **Story 2.4: Unified Agenda View**

    *   **Frontend:**
        *   The `/pages/agenda.tsx` page will be the central component for this.
        *   It will fetch both tasks (personal and Canvas) and Google Calendar events from `/api/tasks` and `/api/calendar/events` respectively.
        *   All items will be combined into a single array and sorted chronologically by their respective due dates or start times.
        *   Visual distinction will be added to clearly differentiate between personal tasks, Canvas assignments, and Google Calendar events.
    *   **Backend:**
        *   The existing `/api/tasks` endpoint and the new `/api/calendar/events` endpoint will provide the necessary data.
  </tech-spec>

  <prisma-schema>
    ```prisma
    model User {
      id            String    @id @default(cuid())
      name          String?
      email         String?   @unique
      emailVerified DateTime?
      image         String?
      accounts      Account[]
      sessions      Session[]
      tasks         Task[]
      calendarEvents CalendarEvent[]
      canvasApiKey  String?
      googleCalendarAccessToken  String?
      googleCalendarRefreshToken String?
      selectedCalendarIds        Json?
      preferredStudyTimes Json?
    }

    model Task {
      id          String   @id @default(cuid())
      userId      String
      user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
      type        String   // CANVAS_ASSIGNMENT or PERSONAL
      canvasAssignmentId String?
      title       String
      description String?
      dueDate     DateTime?
      courseName  String?
      canvasHtmlUrl String?
      isCompleted Boolean  @default(false)
      priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH
      estimatedTime Int?
      timeSpent   Int      @default(0)
      createdAt   DateTime @default(now())
      updatedAt   DateTime @updatedAt
    }

    model CalendarEvent {
      id            String   @id @default(cuid())
      userId        String
      user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
      googleEventId String   @unique
      calendarId    String
      title         String
      description   String?
      startTime     DateTime
      endTime       DateTime
      isAllDay      Boolean  @default(false)
      createdAt     DateTime @default(now())
      updatedAt     DateTime @updatedAt
    }
    ```
  </prisma-schema>

  <file-paths>
    *   API Route: `pages/api/calendar/events.ts`
    *   Agenda Page: `pages/agenda.tsx`
    *   Prisma Schema: `prisma/schema.prisma`
  </file-paths>

  <documentation>
    *   Google Calendar API: Events list: https://developers.google.com/calendar/api/v3/reference/events/list
    *   Google API Node.js Client: https://github.com/googleapis/google-api-nodejs-client
  </documentation>
</context>
