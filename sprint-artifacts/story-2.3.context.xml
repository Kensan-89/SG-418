<context>
  <story>
    **Story 2.3: Select Google Calendars**

    As a logged-in user with a Google Calendar connection,
    I want to choose which of my Google Calendars are displayed,
    So that I can control the information shown and avoid clutter from irrelevant calendars.

    **Acceptance Criteria:**
    1. After connecting, the user is presented with a list of their available Google Calendars.
    2. The user can select/deselect calendars from this list.
    3. Only events from the selected calendars are fetched and displayed.
    4. The user can change their selection at any time in the settings.
  </story>

  <tech-spec>
    **Story 2.3: Google Calendar Display** (This tech spec covers selecting calendars and displaying events)

    *   **Frontend:**
        *   The `/pages/settings.tsx` page will be modified to:
            *   Fetch a list of available Google Calendars from a new API endpoint (`/api/calendar/list`).
            *   Display these calendars with checkboxes or a similar selection mechanism.
            *   Allow the user to save their selected calendar IDs via a `POST` request to `/api/calendar/select`.
    *   **Backend:**
        *   A new API route `pages/api/calendar/list.ts` will be created:
            1.  Retrieve and decrypt the user's Google Calendar access token.
            2.  Use the Google Calendar API to fetch the list of available calendars for the user.
            3.  Return the calendar list (ID, name) to the frontend.
        *   A new API route `pages/api/calendar/select.ts` will be created:
            1.  Receive an array of selected calendar IDs from the frontend.
            2.  Store this array in the `selectedCalendarIds` field of the `User` model (encrypted).
    *   **Database:**
        *   The `User` model will be updated to include `selectedCalendarIds` (Json, encrypted) field.
  </tech-spec>

  <prisma-schema>
    ```prisma
    model User {
      id            String    @id @default(cuid())
      name          String?
      email         String?   @unique
      emailVerified DateTime?
      image         String?
      accounts      Account[]
      sessions      Session[]
      tasks         Task[]
      calendarEvents CalendarEvent[]
      canvasApiKey  String?
      googleCalendarAccessToken  String?
      googleCalendarRefreshToken String?
      selectedCalendarIds        Json?
      preferredStudyTimes Json?
    }
    ```
  </prisma-schema>

  <file-paths>
    *   API Routes: `pages/api/calendar/list.ts`, `pages/api/calendar/select.ts`
    *   Settings Page: `pages/settings.tsx`
    *   Prisma Schema: `prisma/schema.prisma`
  </file-paths>

  <documentation>
    *   Google Calendar API: List calendars: https://developers.google.com/calendar/api/v3/reference/calendarList/list
    *   Google API Node.js Client: https://github.com/googleapis/google-api-nodejs-client
  </documentation>
</context>
